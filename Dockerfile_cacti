FROM php:7.4.33-apache

RUN apt-get update && \
    apt-get install -y \
        git \
        rrdtool \
        mariadb-server \
        snmp \
        snmpd \
        libsnmp-dev \
        libxml2-dev \
        libonig-dev \
        libpng-dev \
        libgmp-dev \
        libzip-dev \
        libldap2-dev

RUN docker-php-ext-install mysqli snmp xml mbstring json gd gmp zip ldap
RUN docker-php-ext-enable mysqli snmp xml mbstring json gd gmp zip ldap

RUN git clone -b release/1.2.22 https://github.com/Cacti/cacti.git --depth 1

COPY ./config/cacti/config.php /var/www/html/cacti/include/config.php

RUN echo "*/5 * * * * apache php /var/www/html/cacti/poller.php &>/dev/null" > /etc/cron.d/cacti
